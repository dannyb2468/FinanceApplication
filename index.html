<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinanceFlow - Personal Finance Tracker</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Track expenses, budgets, and net worth with FinanceFlow">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FinanceFlow">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">

    <!-- Stylesheets -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBwMWhiUNZ5XxR3SMW6hId42ljPCYFZOjI",
            authDomain: "financeflow-b93f4.firebaseapp.com",
            projectId: "financeflow-b93f4",
            storageBucket: "financeflow-b93f4.firebasestorage.app",
            messagingSenderId: "433074497981",
            appId: "1:433074497981:web:b4edcc9d0d02e07b54cad4"
        };

        const firebaseApp = initializeApp(firebaseConfig);
        const auth = getAuth(firebaseApp);
        const db = getFirestore(firebaseApp);

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseFunctions = {
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            doc,
            setDoc,
            getDoc,
            onSnapshot
        };
    </script>
</head>
<body>
    <!-- Onboarding Wizard -->
    <div id="onboarding-overlay" class="onboarding-overlay" style="display:none">
        <div class="onboarding-container">
            <div class="onboarding-progress">
                <span class="onboarding-dot active" data-step="1"></span>
                <span class="onboarding-dot" data-step="2"></span>
                <span class="onboarding-dot" data-step="3"></span>
                <span class="onboarding-dot" data-step="4"></span>
                <span class="onboarding-dot" data-step="5"></span>
            </div>

            <!-- Step 1: Welcome -->
            <div class="onboarding-step active" data-step="1">
                <div class="onboarding-icon"><i class="fas fa-wallet"></i></div>
                <h2>Welcome to FinanceFlow</h2>
                <p>Take control of your finances with envelope budgeting, expense tracking, and net worth monitoring.</p>
                <div class="form-group">
                    <label for="onboard-name">What should we call you?</label>
                    <input type="text" id="onboard-name" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label>Choose your theme</label>
                    <div class="onboarding-theme-picker">
                        <button class="theme-choice active" data-theme="light"><i class="fas fa-sun"></i> Light</button>
                        <button class="theme-choice" data-theme="dark"><i class="fas fa-moon"></i> Dark</button>
                        <button class="theme-choice" data-theme="auto"><i class="fas fa-desktop"></i> System</button>
                    </div>
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" data-action="skip">Skip Setup</button>
                    <button class="btn-primary" data-action="next">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Step 2: Accounts -->
            <div class="onboarding-step" data-step="2">
                <div class="onboarding-icon"><i class="fas fa-university"></i></div>
                <h2>Add Your Accounts</h2>
                <p>Quick-add common account types. You can always add more later.</p>
                <div id="onboard-accounts-list" class="onboard-accounts-list"></div>
                <div class="onboard-add-row">
                    <select id="onboard-account-type">
                        <option value="checking">Checking Account</option>
                        <option value="savings">Savings Account</option>
                        <option value="credit-card">Credit Card</option>
                        <option value="student-loan">Student Loan</option>
                        <option value="auto-loan">Auto Loan</option>
                        <option value="mortgage">Mortgage</option>
                        <option value="brokerage">Brokerage</option>
                        <option value="401k">401(k)</option>
                    </select>
                    <input type="text" id="onboard-account-name" placeholder="Name (e.g. Chase)">
                    <input type="number" id="onboard-account-balance" placeholder="Balance" step="0.01" min="0">
                    <button class="btn-primary btn-sm" data-action="add-account"><i class="fas fa-plus"></i></button>
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" data-action="skip">Skip</button>
                    <button class="btn-primary" data-action="next">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Step 3: Envelopes -->
            <div class="onboarding-step" data-step="3">
                <div class="onboarding-icon"><i class="fas fa-envelope-open-text"></i></div>
                <h2>Set Up Envelopes</h2>
                <p>Envelopes help you pre-allocate money from each paycheck. Check the ones you want.</p>
                <div id="onboard-envelopes-list" class="onboard-envelopes-list">
                    <label class="onboard-envelope-item">
                        <input type="checkbox" checked data-name="Groceries" data-target="400" data-category="groceries" data-color="#a855f7">
                        <span class="onboard-env-name">Groceries</span>
                        <input type="number" class="onboard-env-target" value="400" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" checked data-name="Housing" data-target="1500" data-category="housing" data-color="#6366f1">
                        <span class="onboard-env-name">Housing</span>
                        <input type="number" class="onboard-env-target" value="1500" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" checked data-name="Transportation" data-target="200" data-category="transportation" data-color="#d946ef">
                        <span class="onboard-env-name">Transportation</span>
                        <input type="number" class="onboard-env-target" value="200" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" data-name="Dining Out" data-target="150" data-category="dining" data-color="#ec4899">
                        <span class="onboard-env-name">Dining Out</span>
                        <input type="number" class="onboard-env-target" value="150" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" data-name="Entertainment" data-target="100" data-category="entertainment" data-color="#f43f5e">
                        <span class="onboard-env-name">Entertainment</span>
                        <input type="number" class="onboard-env-target" value="100" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" data-name="Subscriptions" data-target="50" data-category="subscriptions" data-color="#eab308">
                        <span class="onboard-env-name">Subscriptions</span>
                        <input type="number" class="onboard-env-target" value="50" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" data-name="Healthcare" data-target="100" data-category="healthcare" data-color="#f97316">
                        <span class="onboard-env-name">Healthcare</span>
                        <input type="number" class="onboard-env-target" value="100" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                    <label class="onboard-envelope-item">
                        <input type="checkbox" data-name="Savings" data-target="200" data-category="" data-color="#10b981">
                        <span class="onboard-env-name">Savings</span>
                        <input type="number" class="onboard-env-target" value="200" step="1" min="0">
                        <span class="onboard-env-freq">/mo</span>
                    </label>
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" data-action="skip">Skip</button>
                    <button class="btn-primary" data-action="next">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Step 4: Income -->
            <div class="onboarding-step" data-step="4">
                <div class="onboarding-icon"><i class="fas fa-briefcase"></i></div>
                <h2>Add Income Sources</h2>
                <p>Add your jobs or side gigs so you can quickly record paychecks.</p>
                <div id="onboard-income-list" class="onboard-accounts-list"></div>
                <div class="onboard-add-row">
                    <input type="text" id="onboard-income-name" placeholder="e.g. Main Job, Freelance" style="flex:2">
                    <select id="onboard-income-account" style="flex:1">
                        <option value="">Deposit account...</option>
                    </select>
                    <button class="btn-primary btn-sm" data-action="add-income"><i class="fas fa-plus"></i></button>
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" data-action="skip">Skip</button>
                    <button class="btn-primary" data-action="next">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Step 5: Ready -->
            <div class="onboarding-step" data-step="5">
                <div class="onboarding-icon"><i class="fas fa-check-circle"></i></div>
                <h2>You're All Set!</h2>
                <p>Here's what we created for you:</p>
                <div id="onboard-summary" class="onboard-summary"></div>
                <div class="onboarding-actions">
                    <button class="btn-primary btn-lg" data-action="finish"><i class="fas fa-rocket"></i> Get Started</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="mobile-logo">
                <i class="fas fa-wallet"></i>
                <span>FinanceFlow</span>
            </div>
            <button class="mobile-menu-btn" data-action="toggle-sidebar" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-wallet"></i>
                <span>FinanceFlow</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="envelopes">
                    <i class="fas fa-envelope-open-text"></i>
                    <span>Envelopes</span>
                </li>
                <li class="nav-item" data-page="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transactions</span>
                </li>
                <li class="nav-item" data-page="accounts">
                    <i class="fas fa-university"></i>
                    <span>Accounts</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <i class="fas fa-chart-pie"></i>
                    <span>Reports</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div id="user-section" style="display: none;">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="user-email">user@email.com</span>
                    </div>
                    <div class="sync-status" id="sync-status">
                        <i class="fas fa-cloud"></i>
                        <span>Synced</span>
                    </div>
                    <button class="btn-signout" data-action="sign-out">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
                <button id="sign-in-btn" class="btn-export" data-action="open-auth">
                    <i class="fas fa-sign-in-alt"></i> Sign In to Sync
                </button>
                <button class="btn-export" data-action="export-data">
                    <i class="fas fa-download"></i> Export Data
                </button>
            </div>
        </nav>

        <!-- Sidebar Overlay (mobile) -->
        <div class="sidebar-overlay" data-action="close-sidebar"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- ===================== DASHBOARD ===================== -->
            <div id="dashboard-page" class="page active">
                <div class="page-header">
                    <div>
                        <h1 id="dashboard-greeting">Dashboard</h1>
                        <p class="date-display"></p>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card income">
                        <div class="stat-icon"><i class="fas fa-arrow-down"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Income This Month</span>
                            <span class="stat-value" id="monthly-income">$0.00</span>
                        </div>
                    </div>
                    <div class="stat-card expenses">
                        <div class="stat-icon"><i class="fas fa-arrow-up"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Expenses This Month</span>
                            <span class="stat-value" id="monthly-expenses">$0.00</span>
                        </div>
                    </div>
                    <div class="stat-card balance">
                        <div class="stat-icon"><i class="fas fa-balance-scale"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Net This Month</span>
                            <span class="stat-value" id="monthly-balance">$0.00</span>
                        </div>
                    </div>
                    <div class="stat-card networth">
                        <div class="stat-icon"><i class="fas fa-gem"></i></div>
                        <div class="stat-info">
                            <span class="stat-label">Total Net Worth</span>
                            <span class="stat-value" id="total-networth">$0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action-btn" data-action="quick-paycheck">
                        <i class="fas fa-money-check-alt"></i>
                        <span>Record Paycheck</span>
                    </button>
                    <button class="quick-action-btn" data-action="quick-transfer">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Transfer</span>
                    </button>
                    <button class="quick-action-btn" data-action="quick-payment">
                        <i class="fas fa-credit-card"></i>
                        <span>Make Payment</span>
                    </button>
                    <button class="quick-action-btn" data-action="quick-transaction">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Transaction</span>
                    </button>
                </div>

                <div class="dashboard-grid">
                    <div class="card envelope-overview">
                        <h3><i class="fas fa-envelope-open-text"></i> Envelope Status</h3>
                        <div id="envelope-status-bars"></div>
                    </div>
                    <div class="card spending-chart">
                        <h3><i class="fas fa-chart-pie"></i> Spending by Category</h3>
                        <canvas id="spending-pie-chart"></canvas>
                    </div>
                    <div class="card recent-transactions">
                        <h3><i class="fas fa-clock"></i> Recent Transactions</h3>
                        <div id="recent-transactions-list"></div>
                    </div>
                    <div class="card upcoming-recurring">
                        <h3><i class="fas fa-calendar-alt"></i> Upcoming Bills</h3>
                        <div id="upcoming-recurring-list"></div>
                    </div>
                </div>
            </div>

            <!-- ===================== ENVELOPES ===================== -->
            <div id="envelopes-page" class="page">
                <div class="page-header">
                    <h1>Envelopes</h1>
                    <div class="page-header-actions">
                        <button class="btn-secondary" data-action="open-envelope-transfer">
                            <i class="fas fa-exchange-alt"></i> Transfer
                        </button>
                        <button class="btn-secondary" data-action="open-paycheck">
                            <i class="fas fa-money-check-alt"></i> Record Paycheck
                        </button>
                        <button class="btn-primary" data-action="open-envelope">
                            <i class="fas fa-plus"></i> Add Envelope
                        </button>
                    </div>
                </div>

                <div id="envelopes-overdrawn-banner" class="warning-banner" style="display:none">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="warning-message"></span>
                </div>

                <div class="envelope-summary-bar">
                    <div class="envelope-summary-item">
                        <span class="label">Total Funded</span>
                        <span class="value" id="env-total-balance">$0.00</span>
                    </div>
                    <div class="envelope-summary-item">
                        <span class="label">Total Spent</span>
                        <span class="value" id="env-total-spent">$0.00</span>
                    </div>
                    <div class="envelope-summary-item">
                        <span class="label">Monthly Target</span>
                        <span class="value" id="env-monthly-target">$0.00</span>
                    </div>
                    <div class="envelope-summary-item">
                        <span class="label">Per Paycheck <span class="help-tip" data-tip="Based on 26 paychecks per year (bi-weekly)">?</span></span>
                        <span class="value" id="env-per-paycheck">$0.00</span>
                    </div>
                </div>

                <div class="envelopes-grid" id="envelopes-grid"></div>

                <div class="envelopes-section">
                    <div class="section-header">
                        <h3><i class="fas fa-briefcase"></i> Income Sources</h3>
                        <button class="btn-secondary btn-sm" data-action="open-income-source">
                            <i class="fas fa-plus"></i> Add Source
                        </button>
                    </div>
                    <div id="income-sources-list"></div>
                </div>

                <div class="envelopes-section">
                    <div class="section-header">
                        <h3><i class="fas fa-history"></i> Recent Paychecks</h3>
                    </div>
                    <div id="paycheck-history-list"></div>
                </div>
            </div>

            <!-- ===================== TRANSACTIONS ===================== -->
            <div id="transactions-page" class="page">
                <div class="page-header">
                    <h1>Transactions</h1>
                    <button class="btn-primary" data-action="open-transaction">
                        <i class="fas fa-plus"></i> Add Transaction
                    </button>
                </div>

                <!-- Quick-Add Bar -->
                <div class="quick-add-bar">
                    <span class="quick-add-label"><i class="fas fa-bolt"></i> Quick Add</span>
                    <input type="number" id="quick-amount" placeholder="Amount" step="0.01" min="0">
                    <input type="text" id="quick-description" placeholder="Description">
                    <select id="quick-category"></select>
                    <select id="quick-envelope"></select>
                    <button class="btn-primary btn-sm" data-action="quick-add-save">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>

                <!-- Tab Switcher -->
                <div class="tab-bar">
                    <button class="tab-btn active" data-tab="history">History</button>
                    <button class="tab-btn" data-tab="recurring">Recurring</button>
                </div>

                <!-- History Tab -->
                <div class="tab-content active" data-tab="history">
                    <div class="filters-bar">
                        <div class="filter-group">
                            <label>Type:</label>
                            <select id="filter-type">
                                <option value="all">All</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                                <option value="payment">Payment</option>
                                <option value="transfer">Transfer</option>
                                <option value="contribution">Contribution</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Category:</label>
                            <select id="filter-category">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Date Range:</label>
                            <input type="date" id="filter-date-from">
                            <span>to</span>
                            <input type="date" id="filter-date-to">
                        </div>
                        <div class="filter-group">
                            <label>Search:</label>
                            <input type="text" id="filter-search" placeholder="Search transactions...">
                        </div>
                    </div>

                    <div class="card">
                        <table class="data-table" id="transactions-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Recurring Tab -->
                <div class="tab-content" data-tab="recurring">
                    <div class="recurring-summary">
                        <div class="recurring-stat">
                            <i class="fas fa-arrow-down income-icon"></i>
                            <div>
                                <span class="label">Monthly Income</span>
                                <span class="value" id="recurring-income">$0.00</span>
                            </div>
                        </div>
                        <div class="recurring-stat">
                            <i class="fas fa-arrow-up expense-icon"></i>
                            <div>
                                <span class="label">Monthly Expenses</span>
                                <span class="value" id="recurring-expenses">$0.00</span>
                            </div>
                        </div>
                        <div class="recurring-stat">
                            <i class="fas fa-calculator"></i>
                            <div>
                                <span class="label">Net Monthly</span>
                                <span class="value" id="recurring-net">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="display:flex; justify-content:flex-end; padding:12px 24px; margin-bottom:16px;">
                        <button class="btn-primary" data-action="open-recurring">
                            <i class="fas fa-plus"></i> Add Recurring
                        </button>
                    </div>

                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Frequency</th>
                                    <th>Next Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recurring-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ===================== ACCOUNTS ===================== -->
            <div id="accounts-page" class="page">
                <div class="page-header">
                    <h1>Accounts</h1>
                    <button class="btn-primary" data-action="open-asset">
                        <i class="fas fa-plus"></i> Add Account
                    </button>
                </div>

                <div class="networth-summary">
                    <div class="networth-card assets">
                        <i class="fas fa-university"></i>
                        <div>
                            <span class="label">Total Assets</span>
                            <span class="value" id="total-assets">$0.00</span>
                        </div>
                    </div>
                    <div class="networth-card liabilities">
                        <i class="fas fa-credit-card"></i>
                        <div>
                            <span class="label">Total Liabilities</span>
                            <span class="value" id="total-liabilities">$0.00</span>
                        </div>
                    </div>
                    <div class="networth-card net">
                        <i class="fas fa-gem"></i>
                        <div>
                            <span class="label">Net Worth</span>
                            <span class="value" id="networth-value">$0.00</span>
                        </div>
                    </div>
                </div>

                <div id="accounts-sections"></div>

                <div class="card networth-history-card">
                    <h3><i class="fas fa-chart-line"></i> Net Worth Over Time</h3>
                    <canvas id="networth-chart"></canvas>
                </div>
            </div>

            <!-- ===================== REPORTS ===================== -->
            <div id="reports-page" class="page">
                <div class="page-header">
                    <h1>Reports</h1>
                    <div class="report-period-selector">
                        <select id="report-period">
                            <option value="thisMonth">This Month</option>
                            <option value="lastMonth">Last Month</option>
                            <option value="last3Months">Last 3 Months</option>
                            <option value="last6Months">Last 6 Months</option>
                            <option value="thisYear">This Year</option>
                            <option value="allTime">All Time</option>
                        </select>
                    </div>
                </div>

                <!-- Budget Compliance Section -->
                <div class="card budget-compliance-card">
                    <h3><i class="fas fa-tasks"></i> Budget Compliance <span class="help-tip" data-tip="Compares your actual spending to envelope targets">?</span></h3>
                    <div id="budget-compliance-summary" class="budget-compliance-summary"></div>
                    <div id="budget-compliance-bars"></div>
                </div>

                <div class="reports-grid">
                    <div class="card chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Income vs Expenses</h3>
                        <canvas id="income-expense-chart"></canvas>
                    </div>
                    <div class="card chart-card">
                        <h3><i class="fas fa-chart-pie"></i> Expense Breakdown</h3>
                        <canvas id="expense-breakdown-chart"></canvas>
                    </div>
                    <div class="card chart-card">
                        <h3><i class="fas fa-chart-line"></i> Spending Trend</h3>
                        <canvas id="spending-trend-chart"></canvas>
                    </div>
                    <div class="card chart-card">
                        <h3><i class="fas fa-chart-area"></i> Savings Rate</h3>
                        <canvas id="savings-chart"></canvas>
                    </div>
                </div>

                <div class="card stats-table-card">
                    <h3><i class="fas fa-table"></i> Category Statistics</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total Spent</th>
                                <th>Transactions</th>
                                <th>Average</th>
                                <th>% of Total</th>
                            </tr>
                        </thead>
                        <tbody id="category-stats-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- ===================== SETTINGS ===================== -->
            <div id="settings-page" class="page">
                <div class="page-header">
                    <h1>Settings</h1>
                </div>

                <div class="settings-grid">
                    <!-- Profile Card -->
                    <div class="card settings-card">
                        <h3><i class="fas fa-user"></i> Profile</h3>
                        <div class="setting-item">
                            <label for="settings-name">Display Name</label>
                            <input type="text" id="settings-name" placeholder="Your name">
                        </div>
                        <div class="setting-item" style="border-bottom:none; padding-top:16px;">
                            <button class="btn-secondary" data-action="rerun-onboarding">
                                <i class="fas fa-redo"></i> Re-run Setup Wizard
                            </button>
                        </div>
                    </div>

                    <div class="card settings-card">
                        <h3><i class="fas fa-palette"></i> Appearance</h3>
                        <div class="setting-item">
                            <label>Theme</label>
                            <select id="theme-select">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">System Default</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Currency Symbol</label>
                            <select id="currency-select">
                                <option value="$">$ (USD)</option>
                                <option value="€">€ (EUR)</option>
                                <option value="£">£ (GBP)</option>
                                <option value="¥">¥ (JPY/CNY)</option>
                                <option value="₹">₹ (INR)</option>
                                <option value="₿">₿ (BTC)</option>
                            </select>
                        </div>
                    </div>

                    <div class="card settings-card">
                        <h3><i class="fas fa-tags"></i> Categories</h3>
                        <div class="categories-list" id="categories-list"></div>
                        <div class="add-category-form">
                            <input type="text" id="new-category-name" placeholder="Category name">
                            <input type="color" id="new-category-color" value="#6366f1">
                            <select id="new-category-type">
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                            <button class="btn-primary" data-action="add-category">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <div class="card settings-card">
                        <h3><i class="fas fa-database"></i> Data Management</h3>
                        <div class="data-actions">
                            <button class="btn-secondary" data-action="export-data">
                                <i class="fas fa-download"></i> Export All Data
                            </button>
                            <label class="btn-secondary file-input-label">
                                <i class="fas fa-upload"></i> Import Data
                                <input type="file" id="import-file" accept=".json" hidden>
                            </label>
                            <button class="btn-danger" data-action="clear-data">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>
                    </div>

                    <div class="card settings-card">
                        <h3><i class="fas fa-info-circle"></i> About</h3>
                        <div class="about-info">
                            <p><strong>FinanceFlow</strong> v2.0</p>
                            <p>A personal finance tracking application with envelope budgeting.</p>
                            <p class="privacy-note"><i class="fas fa-lock"></i> Your data never leaves your device unless you enable cloud sync.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ===================== MODALS ===================== -->

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="transaction-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="transaction-modal-title">Add Transaction</h2>
                <button class="modal-close" data-action="close-modal" data-modal="transaction-modal" aria-label="Close">&times;</button>
            </div>
            <form id="transaction-form">
                <input type="hidden" id="transaction-id">
                <div class="form-group">
                    <label>Type</label>
                    <div class="toggle-group toggle-group-5">
                        <input type="radio" name="trans-type" id="trans-expense" value="expense" checked>
                        <label for="trans-expense" class="toggle-btn">Expense</label>
                        <input type="radio" name="trans-type" id="trans-income" value="income">
                        <label for="trans-income" class="toggle-btn">Income</label>
                        <input type="radio" name="trans-type" id="trans-transfer" value="transfer">
                        <label for="trans-transfer" class="toggle-btn">Transfer</label>
                        <input type="radio" name="trans-type" id="trans-payment" value="payment">
                        <label for="trans-payment" class="toggle-btn">Payment</label>
                        <input type="radio" name="trans-type" id="trans-contribution" value="contribution">
                        <label for="trans-contribution" class="toggle-btn">Contribution</label>
                    </div>
                </div>
                <div class="form-group" id="trans-from-account-group">
                    <label for="trans-from-account">Pay From</label>
                    <select id="trans-from-account">
                        <option value="">Cash / External</option>
                    </select>
                </div>
                <div class="form-group" id="trans-to-account-group" style="display: none;">
                    <label for="trans-to-account">To Account</label>
                    <select id="trans-to-account">
                        <option value="">External</option>
                    </select>
                </div>
                <div class="form-group" id="trans-contrib-type-group" style="display: none;">
                    <label>Contribution Type</label>
                    <div class="toggle-group">
                        <input type="radio" name="trans-contrib-type" id="trans-contrib-pretax" value="pretax" checked>
                        <label for="trans-contrib-pretax" class="toggle-btn">Pre-Tax</label>
                        <input type="radio" name="trans-contrib-type" id="trans-contrib-posttax" value="posttax">
                        <label for="trans-contrib-posttax" class="toggle-btn">Post-Tax</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="trans-amount">Amount</label>
                    <input type="number" id="trans-amount" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="trans-description">Description</label>
                    <input type="text" id="trans-description" required placeholder="What was this for?">
                </div>
                <div class="form-group" id="trans-category-group">
                    <label for="trans-category">Category</label>
                    <select id="trans-category" required></select>
                </div>
                <div class="form-group" id="trans-envelope-group">
                    <label for="trans-envelope">Envelope <span class="help-tip" data-tip="Optionally deduct this expense from an envelope">?</span></label>
                    <select id="trans-envelope">
                        <option value="">None</option>
                    </select>
                </div>
                <div id="trans-envelope-alloc" class="paycheck-allocation-section" style="display:none">
                    <label>Envelope Allocations <span class="help-tip" data-tip="Split this CC payment across your envelopes">?</span></label>
                    <div class="paycheck-alloc-header">
                        <span>Envelope</span>
                        <span>Balance</span>
                        <span>Deduct</span>
                    </div>
                    <div id="trans-envelope-alloc-rows"></div>
                    <div class="paycheck-unallocated">
                        <span>Unallocated:</span>
                        <span id="trans-alloc-unallocated" class="paycheck-unallocated-value">$0.00</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="trans-date">Date</label>
                    <input type="date" id="trans-date" required>
                </div>
                <div class="form-group">
                    <label for="trans-notes">Notes (Optional)</label>
                    <textarea id="trans-notes" placeholder="Additional details..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="transaction-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recurring Modal -->
    <div id="recurring-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="recurring-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="recurring-modal-title">Add Recurring Transaction</h2>
                <button class="modal-close" data-action="close-modal" data-modal="recurring-modal" aria-label="Close">&times;</button>
            </div>
            <form id="recurring-form">
                <input type="hidden" id="recurring-id">
                <div class="form-group">
                    <label>Type</label>
                    <div class="toggle-group">
                        <input type="radio" name="rec-type" id="rec-expense" value="expense" checked>
                        <label for="rec-expense" class="toggle-btn">Expense</label>
                        <input type="radio" name="rec-type" id="rec-income" value="income">
                        <label for="rec-income" class="toggle-btn">Income</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="rec-name">Name</label>
                    <input type="text" id="rec-name" required placeholder="e.g., Netflix, Salary">
                </div>
                <div class="form-group">
                    <label for="rec-amount">Amount</label>
                    <input type="number" id="rec-amount" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="rec-category">Category</label>
                    <select id="rec-category" required></select>
                </div>
                <div class="form-group">
                    <label for="rec-frequency">Frequency</label>
                    <select id="rec-frequency" required>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rec-next-date">Next Due Date</label>
                    <input type="date" id="rec-next-date" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="recurring-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Recurring</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Asset/Account Modal -->
    <div id="asset-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="asset-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="asset-modal-title">Add Account</h2>
                <button class="modal-close" data-action="close-modal" data-modal="asset-modal" aria-label="Close">&times;</button>
            </div>
            <form id="asset-form">
                <input type="hidden" id="asset-id">
                <div class="form-group">
                    <label>Type</label>
                    <div class="toggle-group">
                        <input type="radio" name="asset-type" id="asset-asset" value="asset" checked>
                        <label for="asset-asset" class="toggle-btn">Asset</label>
                        <input type="radio" name="asset-type" id="asset-liability" value="liability">
                        <label for="asset-liability" class="toggle-btn">Liability</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="asset-name">Name</label>
                    <input type="text" id="asset-name" required placeholder="e.g., Savings Account, Car Loan">
                </div>
                <div class="form-group">
                    <label for="asset-value">Current Value</label>
                    <input type="number" id="asset-value" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="asset-category-select">Account Type</label>
                    <select id="asset-category-select" required>
                        <optgroup label="Bank Accounts">
                            <option value="checking">Checking Account</option>
                            <option value="savings">Savings Account</option>
                            <option value="cash">Cash</option>
                        </optgroup>
                        <optgroup label="Investment Accounts">
                            <option value="brokerage">Brokerage Account</option>
                            <option value="crypto">Cryptocurrency</option>
                        </optgroup>
                        <optgroup label="Retirement Accounts">
                            <option value="401k">401(k)</option>
                            <option value="403b">403(b)</option>
                            <option value="ira">Traditional IRA</option>
                            <option value="roth-ira">Roth IRA</option>
                            <option value="pension">Pension</option>
                        </optgroup>
                        <optgroup label="Health & Education">
                            <option value="hsa">HSA (Health Savings)</option>
                            <option value="fsa">FSA (Flexible Spending)</option>
                            <option value="529">529 College Savings</option>
                        </optgroup>
                        <optgroup label="Physical Assets">
                            <option value="property">Property/Real Estate</option>
                            <option value="vehicles">Vehicles</option>
                            <option value="other-asset">Other Assets</option>
                        </optgroup>
                        <optgroup label="Credit Cards">
                            <option value="credit-card">Credit Card</option>
                        </optgroup>
                        <optgroup label="Loans">
                            <option value="auto-loan">Auto Loan</option>
                            <option value="personal-loan">Personal Loan</option>
                            <option value="student-loan">Student Loan</option>
                            <option value="mortgage">Mortgage</option>
                            <option value="heloc">HELOC</option>
                            <option value="other-debt">Other Debt</option>
                        </optgroup>
                    </select>
                </div>
                <div id="account-fields" class="account-fields" style="display: none;">
                    <div class="form-group" id="institution-group">
                        <label for="asset-institution">Institution/Bank</label>
                        <input type="text" id="asset-institution" placeholder="e.g., Chase, Fidelity, Vanguard">
                    </div>
                    <div class="form-group" id="account-number-group">
                        <label for="asset-account-last4">Last 4 of Account #</label>
                        <input type="text" id="asset-account-last4" maxlength="4" placeholder="1234">
                    </div>
                </div>
                <div id="retirement-fields" class="account-fields" style="display: none;">
                    <div class="form-group">
                        <label for="asset-employer-match">Employer Match %</label>
                        <input type="number" id="asset-employer-match" step="0.1" min="0" max="100" placeholder="e.g., 4">
                    </div>
                    <div class="form-group">
                        <label for="asset-contribution-limit">Annual Contribution Limit</label>
                        <input type="number" id="asset-contribution-limit" step="1" min="0" placeholder="e.g., 23000">
                    </div>
                    <div class="form-group">
                        <label for="asset-ytd-contribution">YTD Contributions</label>
                        <input type="number" id="asset-ytd-contribution" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>
                <div id="debt-fields" class="account-fields" style="display: none;">
                    <div class="form-group">
                        <label for="asset-rate">Interest Rate (% APR)</label>
                        <input type="number" id="asset-rate" step="0.01" min="0" max="100" placeholder="e.g., 6.5">
                    </div>
                    <div class="form-group">
                        <label for="asset-min-payment">Minimum Monthly Payment</label>
                        <input type="number" id="asset-min-payment" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="asset-original">Original Loan Amount</label>
                        <input type="number" id="asset-original" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group" id="credit-limit-group" style="display: none;">
                        <label for="asset-credit-limit">Credit Limit</label>
                        <input type="number" id="asset-credit-limit" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label for="asset-notes">Notes (Optional)</label>
                    <textarea id="asset-notes" placeholder="Additional details..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="asset-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Unified Account Action Modal (replaces contribution/payment/withdrawal modals) -->
    <div id="account-action-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="account-action-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="account-action-modal-title">Account Action</h2>
                <button class="modal-close" data-action="close-modal" data-modal="account-action-modal" aria-label="Close">&times;</button>
            </div>
            <form id="account-action-form">
                <input type="hidden" id="action-asset-id">
                <input type="hidden" id="action-type">
                <div id="action-info" class="debt-payment-info"></div>
                <div class="form-group" id="action-contrib-type-group" style="display:none">
                    <label>Contribution Type</label>
                    <div class="toggle-group">
                        <input type="radio" name="contrib-type" id="contrib-pretax" value="pretax" checked>
                        <label for="contrib-pretax" class="toggle-btn">Pre-Tax</label>
                        <input type="radio" name="contrib-type" id="contrib-posttax" value="posttax">
                        <label for="contrib-posttax" class="toggle-btn">Post-Tax</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="action-amount" id="action-amount-label">Amount</label>
                    <input type="number" id="action-amount" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group" id="action-account-group">
                    <label for="action-account" id="action-account-label">Pay From</label>
                    <select id="action-account">
                        <option value="">Cash / External</option>
                    </select>
                </div>
                <div id="action-payment-split" class="payment-split" style="display:none">
                    <div class="split-row">
                        <span class="label">Principal:</span>
                        <span id="action-principal" class="value principal">$0.00</span>
                    </div>
                    <div class="split-row">
                        <span class="label">Interest:</span>
                        <span id="action-interest" class="value interest">$0.00</span>
                    </div>
                </div>
                <div id="action-envelope-alloc" class="paycheck-allocation-section" style="display:none">
                    <div class="paycheck-alloc-header">
                        <span>Envelope</span>
                        <span>Balance</span>
                        <span>Deduct</span>
                    </div>
                    <div id="action-envelope-rows"></div>
                    <div class="paycheck-unallocated">
                        <span>Unallocated:</span>
                        <span id="action-unallocated" class="paycheck-unallocated-value">$0.00</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="action-date">Date</label>
                    <input type="date" id="action-date" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="account-action-modal">Cancel</button>
                    <button type="submit" class="btn-primary" id="action-submit-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Account Details Modal -->
    <div id="account-details-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="account-details-title">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="account-details-title">Account Details</h2>
                <button class="modal-close" data-action="close-modal" data-modal="account-details-modal" aria-label="Close">&times;</button>
            </div>
            <div class="account-details-content">
                <div class="account-summary" id="account-summary"></div>
                <div class="account-actions" id="account-actions"></div>
                <h3>Transaction History</h3>
                <div class="account-history" id="account-history"></div>
            </div>
        </div>
    </div>

    <!-- Envelope Modal -->
    <div id="envelope-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="envelope-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="envelope-modal-title">Add Envelope</h2>
                <button class="modal-close" data-action="close-modal" data-modal="envelope-modal" aria-label="Close">&times;</button>
            </div>
            <form id="envelope-form">
                <input type="hidden" id="envelope-id">
                <div class="form-group">
                    <label for="envelope-name">Envelope Name</label>
                    <input type="text" id="envelope-name" required placeholder="e.g., Groceries, Car Insurance">
                </div>
                <div class="form-group">
                    <label for="envelope-category">Default Category <span class="help-tip" data-tip="Transactions with this category will auto-suggest this envelope">?</span></label>
                    <select id="envelope-category">
                        <option value="">None</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="envelope-target">Target Amount <span class="help-tip" data-tip="This is your budget target. Reports will track spending against this.">?</span></label>
                    <input type="number" id="envelope-target" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="envelope-frequency">Target Frequency</label>
                    <select id="envelope-frequency">
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="envelope-color">Color</label>
                    <input type="color" id="envelope-color" value="#6366f1">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="envelope-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Envelope</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Paycheck Modal -->
    <div id="paycheck-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="paycheck-modal-title">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="paycheck-modal-title">Record Paycheck</h2>
                <button class="modal-close" data-action="close-modal" data-modal="paycheck-modal" aria-label="Close">&times;</button>
            </div>
            <form id="paycheck-form">
                <div class="form-group">
                    <label for="paycheck-source">Income Source</label>
                    <select id="paycheck-source">
                        <option value="">Select income source...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="paycheck-amount">Total Amount</label>
                        <input type="number" id="paycheck-amount" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="paycheck-account">Deposit Account</label>
                        <select id="paycheck-account">
                            <option value="">Select account...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="paycheck-date">Date</label>
                        <input type="date" id="paycheck-date" required>
                    </div>
                </div>
                <div class="paycheck-allocation-section">
                    <div class="paycheck-alloc-header">
                        <span>Envelope</span>
                        <span>Balance</span>
                        <span>Allocate</span>
                    </div>
                    <div id="paycheck-allocations"></div>
                    <div class="paycheck-unallocated">
                        <span>Unallocated:</span>
                        <span id="paycheck-unallocated" class="paycheck-unallocated-value">$0.00</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="paycheck-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Record Paycheck</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Income Source Modal -->
    <div id="income-source-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="income-source-modal-title">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="income-source-modal-title">Add Income Source</h2>
                <button class="modal-close" data-action="close-modal" data-modal="income-source-modal" aria-label="Close">&times;</button>
            </div>
            <form id="income-source-form">
                <input type="hidden" id="income-source-id">
                <div class="form-group">
                    <label for="income-source-name">Source Name</label>
                    <input type="text" id="income-source-name" required placeholder="e.g., Main Job, Freelance">
                </div>
                <div class="form-group">
                    <label for="income-source-account">Default Deposit Account</label>
                    <select id="income-source-account">
                        <option value="">None</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="income-source-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Source</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Envelope Transfer Modal -->
    <div id="envelope-transfer-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="envelope-transfer-modal-title">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="envelope-transfer-modal-title">Transfer Between Envelopes</h2>
                <button class="modal-close" data-action="close-modal" data-modal="envelope-transfer-modal" aria-label="Close">&times;</button>
            </div>
            <form id="envelope-transfer-form">
                <div class="form-group">
                    <label for="transfer-from-envelope">From Envelope</label>
                    <select id="transfer-from-envelope" required>
                        <option value="">Select envelope...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transfer-to-envelope">To Envelope</label>
                    <select id="transfer-to-envelope" required>
                        <option value="">Select envelope...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="envelope-transfer-amount">Amount</label>
                    <input type="number" id="envelope-transfer-amount" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="close-modal" data-modal="envelope-transfer-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Transfer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="confirm-title">Confirm</h2>
                <button class="modal-close" data-action="close-modal" data-modal="confirm-dialog" aria-label="Close">&times;</button>
            </div>
            <p id="confirm-message"></p>
            <div class="modal-actions">
                <button class="btn-secondary" data-action="close-modal" data-modal="confirm-dialog">Cancel</button>
                <button class="btn-danger" id="confirm-action-btn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="auth-modal-title">Sign In</h2>
                <button class="modal-close" data-action="close-modal" data-modal="auth-modal" aria-label="Close">&times;</button>
            </div>
            <form id="auth-form">
                <div class="form-group">
                    <label for="auth-email">Email</label>
                    <input type="email" id="auth-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" required placeholder="Your password" minlength="6">
                </div>
                <div id="auth-error" class="auth-error"></div>
                <div class="modal-actions" style="flex-direction: column; gap: 12px;">
                    <button type="submit" class="btn-primary" style="width: 100%;" id="auth-submit-btn">Sign In</button>
                    <p style="text-align: center; color: var(--text-secondary); margin: 0;">
                        <span id="auth-toggle-text">Don't have an account?</span>
                        <a href="#" id="auth-toggle-link" data-action="toggle-auth">Sign Up</a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <button class="mobile-nav-item active" data-page="dashboard">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="mobile-nav-item" data-page="envelopes">
            <i class="fas fa-envelope-open-text"></i>
            <span>Envelopes</span>
        </button>
        <button class="mobile-nav-item" data-page="transactions">
            <i class="fas fa-exchange-alt"></i>
            <span>Transactions</span>
        </button>
        <button class="mobile-nav-item" data-page="accounts">
            <i class="fas fa-university"></i>
            <span>Accounts</span>
        </button>
        <button class="mobile-nav-item" data-page="reports">
            <i class="fas fa-chart-pie"></i>
            <span>Reports</span>
        </button>
    </nav>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('FinanceFlow: Service Worker registered');
                    })
                    .catch((error) => {
                        console.log('FinanceFlow: Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
